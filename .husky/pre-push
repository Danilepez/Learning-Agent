#!/usr/bin/env sh
set -e

echo "Running full test suite before push..."

if npm --prefix backend test -- --passWithNoTests && npm --prefix client test -- --passWithNoTests; then
  echo "All tests passed"
else
  echo "Tests failed, push aborted"
  exit 1
fi

echo "Running client lint..."
if npm --prefix client run lint; then
  echo "Lint passed"
else
  echo "Lint failed, push aborted"
  exit 1
fi

echo "Running backend lint..."
if npm --prefix backend run lint; then
  echo "Lint passed"
else
  echo "Lint failed, push aborted"
  exit 1
fi

echo "Running security audit..."
if npm audit --production --audit-level=high; then
  echo "No high-severity vulnerabilities"
else
  echo "Security issues found"
fi
